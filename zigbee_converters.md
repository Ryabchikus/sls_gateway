# Zigbee конвертеры

## Введение

Для преобразования сообщений между Zigbee устройством и состояниями в шлюзе используются конвертеры. Полученные состояния далее используются для взаимодействия как с внешними системами, так и для автоматизаций посредством скриптов LUA.

## Конвертер

Конвертер - это скрипт в прошивке SLS, который выполняет преобразование сообщений Zigbee в состояния шлюза. Скрипт состоит из несколькич частей:

- `Conf` - конфигурирует устройства (бинд кластеров, конфигурация репортинга, чтение атрибутов) и создает начальные состояния
- `FZ` - FromZigbee преобразует данные получаемые от устройства в состояния шлюза
- `TZ` - ToZigbee по командам в состояних отправляет команды устройству на установку (SET) и получение (GET) значений

Конвертеры имеют № - CID. Если подключаемое к SLS устройство поддерживается, значит для него есть конвертер:

![устройство поддерживается](/img/converter_ok.png)

Также отображается и конвертер настроенный вручную.

Если же устройство не поддерживается, то в карточке устройства поле `Converter Id` будет пустым:

![устройство не поддерживается](/img/converter_no.png)

Здесь же имеются соответствующие кнопки для управления конвертером: ![кнопки](/img/converter_btn.png) - переконфигурировать (`CONF` в конвертере), изменить и перейти к данной инструкции.

Вы можете выбрать конвертер из [каталога](https://slsys.io/ru/action/supported_devices.html)

## Изменение конвертера

Если при подключении устройства видим, что устройство не  поддерживается, то можно подобрать похожее по внешнему виду и описанию устройство в каталоге и прописать его ID

![каталог](/img/converter_cat.png)

![смена CID](/img/converter_ch.png)

![смена CID](/img/converter_ch2.png)

## Новая система конвертеров

До введения новой системы конвертеров и возможности их смены, конвертеры добавлялись без выделения отдельного номера, поэтому большое количество старых устройств работают при 0 конвертере.

Все новые устройства добавляются уже на отдельные номера конвертеров, а старые конвертеры постепенно переводятся на новую систему так же с выделением отдельного номера.

Если конвертер по новой системе не найден, но найден по старой, то ставится 0 и устройством может нормально работать. Если конвертера нет ни в старой, ни в новой системе, то поле CID остается пустым.

## Автоконфигурация конвертера

При подключении нового устройства запускается поиск для него подходящего конвертера. Автоконфигурация также запускается, если вручную выставить 0 конвертер. При этом очищаются все состояния. Также, состояния очищаются при ручном перезапуске конвертера (кнопка Reload Converter ID в карточке устройства). Очистить состояния может быть также полезно при необходимости удаления виртуальных состояний, созданных из скриптов.

При 0 и пустом конвертере, в большинстве случаев, его можно подобрать в каталоге. Возможно не совпадает ManufName.
